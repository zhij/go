<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
	<title>这放影机里装...装的是什么</title>
	<link rel="stylesheet" href="css/swiper.min.css">
	<link rel="stylesheet" href="css/style.css">
	<script type="text/javascript">
		;(function (doc, win) {
	        var docEl = doc.documentElement,
	            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
	            recalc = function () {
	                var clientWidth = docEl.clientWidth;
	                if (!clientWidth) return;
	                if(clientWidth>=450){
	                    docEl.style.fontSize = '60px';
	                }else{
	                    docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
	                }
	            };

	        if (!doc.addEventListener) return;
	        win.addEventListener(resizeEvt, recalc, false);
	        doc.addEventListener('DOMContentLoaded', recalc, false);
	    })(document, window);
	</script>
</head>
<body>
	<div id="wrp" class="wrp demo1">
		<div class="ico-music play"></div>
		<div class="swiper-container">
	        <div class="swiper-wrapper">
	            <div class="swiper-slide p-d swiper-no-swiping">
	            	<div class="p-d-title-wrp p-d-common">
	            		<div class="p-d-title p-d-common"></div>
	            	</div>
	            	<div class="p-d-line">
	            		<div class="p-d-line-img">
	            			<canvas id="canvas" class="canvas">
	            		</div>
	            		
	            	</div>
	            	<div class="p-d-light">
	            		<div class="p-d-light-low"></div>
	            		<div class="p-d-light-hight"></div>
	            		<div class="p-d-light-des"></div>
	            	</div>
	            	<div class="p-d-video p-d-common">
	            		<a class="p-d-video-btn p-d-common go-next" href="javascript:;"></a>
	            	</div>
	            </div>
	            <div class="swiper-slide p-d2 swiper-no-swiping">
					<div class="p-d2-logo p-d-common"></div>
						<div class="p-d2-line">
							<div class="p-d2-screen">
			            		<div class="p-d2-line-img p-d2-line-img1"></div>
			            		<div class="p-d2-line-img p-d2-line-img2"></div>
			            		<div class="p-d2-line-img p-d2-line-img3"></div>
			            		<div class="p-d2-line-img p-d2-line-img4"></div>
			            		<div class="p-d2-line-img p-d2-line-img5"></div>
			            	</div>
			            	<div class="p-d-arrow"></div>
	            		</div>
	            	<div class="p-d2-des"></div>
	            	<div class="p-d2-bottom">
	            		<div class="p-d2-btn">
		            		<div class="p-d2-back">
			            	</div>
			            	<a class="p-d2-back-a p-d-common center" href="index.html?pagefrom=details"></a>
		            	</div>
		            	<div class="p-d2-btn">
			            	<div class="p-d2-share">
			            	</div>
			            	<a id="goto-share" class="p-d2-share-a p-d-common center" href="javascript:;"></a>
		            	</div>
	            	</div>
	            	<div class="p-d2-ad">
	            		<div class="p-d2-ad-item p-d-common ad1"></div>
	            	</div>
	            </div>
	            <div class="swiper-slide p-s swiper-no-swiping">
					<div class="p-s-des"></div>
					<!-- <div id="show-layer" class="p-s-men swing"></div> -->
					<div id="show-layer" class="p-s-men">
						<div class="p-s-men-top men"></div>
					</div>
					<div class="p-s-logo"></div>
					<div class="p-s-bottom">
						<div class="p-s-kl">
							<div class="p-s-logo1"></div>
							<div class="p-d2-logo p-d-common p-s-logo2"></div>
						</div>
						<img class="p-s-qrcode" src="images/p-s-qrcode.png" alt="">
					</div>
	            </div>
            </div>
        </div>
        <div class="share-layer">
			<div class="p-s-arrow"></div>
			<div class="p-s-share swing"></div>
		</div>
    </div>
    <audio id="bgm" autoplay loop="loop">
	您的浏览器不支持 audio 标签。
	</audio>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script type="text/javascript" src="js/swiper.jquery.min.js"></script>
	<script type="text/javascript" src="js/canvas.js"></script>
	<script type="text/javascript">
		var swiper1 = new Swiper('.swiper-container', {
			direction : 'vertical',
			noSwiping : true
		});
		$(".go-next").click(function(){
			swiper1.slideNext();
		})

		//获取url中的参数
		function getUrlParam(name) {
		    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
		    var r = window.location.search.substr(1).match(reg);  //匹配目标参数
		    if (r != null) return unescape(r[2]); return null; //返回参数值
		}

		var demoList = [
			{
				imgsLen: 5,
				adLen: 1
			},
			{
				imgsLen: 4,
				adLen: 2
			},
			{
				imgsLen: 6,
				adLen: 1
			},
			{
				imgsLen: 5,
				adLen: 1
			},
			{
				imgsLen: 5,
				adLen: 1
			}
		];

		var pagefrom = getUrlParam("pagefrom");
		switch(parseInt(pagefrom)){
			case 2:
			case 3:
			case 4:
			case 5:
				var demoItem = demoList[pagefrom-1];
		    	var demoClass = "demo"+pagefrom;
		    	var currentBgm = "music/demo"+pagefrom+".mp3";
		    	$("#bgm").attr("src",currentBgm);
		    	$("#wrp").removeClass("demo1").addClass(demoClass);
		    	var screenHtml = "";
		    	for(var i=0; i<demoItem.imgsLen; i++){
		    		screenHtml += '<div class="p-d2-line-img p-d2-line-img'+(i+1)+'"></div>';
		    	}
		    	var width = (2.2 * demoItem.imgsLen)+'rem';
		    	$(".p-d2-screen").html(screenHtml).css("width",width);
		    	if(demoItem.adLen == 2){
		    		$(".p-d2-ad").append('<div class="p-d2-ad-item p-d-common ad2"></div>');
		    	}
		    	break;
		    default: 
		    	var defaultBgm = "music/demo1.mp3";
		    	$("#bgm").attr("src",defaultBgm);
		}
		setTimeout(function(){
    		$("#canvas").fadeOut();
    		$(".p-d-line-img").addClass("show");
    	},1000);
		$("#goto-share").click(function(){
			swiper1.slideNext();
			if($(".ico-music").hasClass("play")){
				$("#bgm").attr("src",'music/share.mp3');
			}
		})

		// 音乐播放，暂停
		$(".ico-music").click(function(){
			if(swiper1.activeIndex == 2){
				if($("#bgm").attr("src") != "music/share.mp3"){
					$("#bgm").attr("src",'music/share.mp3');
				}
			} 
			// 正在播放
			if($(this).hasClass("play")){
				$(this).removeClass("play");
				$("#bgm")[0].pause(); 
			}else {
				$(this).addClass("play");
				$("#bgm")[0].play(); 
			}
		})

		//一般情况下，这样就可以自动播放了，但是一些奇葩iPhone机不可以 
		document.getElementById('bgm').play(); 
		//必须在微信Weixin JSAPI的WeixinJSBridgeReady才能生效 
		document.addEventListener("WeixinJSBridgeReady", function () { 
		    document.getElementById('bgm').play(); 
		}, false);

		// 分享弹层
		$("#show-layer").click(function(){
			$(".share-layer").show();
			$(".p-s-men-top").removeClass("men");
		})

		$(".share-layer").click(function(){
			$(this).hide();
			$(".p-s-men-top").addClass("men");
		})

	</script>
</body>
</html>